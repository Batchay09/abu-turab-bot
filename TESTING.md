# Инструкция по тестированию бота Abu Turab

**Бот**: @true09Bot

---

## Команды бота

| Команда | Описание |
|---------|----------|
| `/start` | Главное меню |
| `/ask` | Задать вопрос |
| `/help` | Справка |
| `/admin` | Админ-панель (только для админов) |

---

## Тестирование пользовательского функционала

### 1. Поиск похожих вопросов
- Нажать "Задать вопрос" или `/ask`
- Ввести вопрос на тему, которая уже есть в базе (например: "как делать намаз", "что такое закят")
- **Проверить**: показываются ли похожие ответы из канала
- **Проверить**: работают ли кнопки "Показать ответ" и ссылки на посты в канале

### 2. Отправка нового вопроса
- Задать уникальный вопрос, которого нет в базе
- **Проверить**: приходит ли подтверждение о принятии вопроса
- **Проверить**: отображается ли номер вопроса

### 3. Валидация ввода
- Попробовать отправить слишком короткий вопрос (менее 10 символов)
- Попробовать отправить очень длинный текст (более 2000 символов)
- **Проверить**: выводятся ли сообщения об ошибках

### 4. Отмена действия
- Начать задавать вопрос и нажать "Отмена"
- **Проверить**: возвращается ли бот в главное меню

---

## Тестирование админ-панели

### 1. Доступ к панели
- Отправить `/admin` или `/start`
- **Проверить**: открывается ли админ-панель с статистикой

### 2. Статистика
- **Проверить**: отображается ли количество вопросов в очереди
- **Проверить**: показывается ли счётчик "отвечено сегодня"

### 3. Просмотр очереди
- Нажать "Очередь вопросов"
- **Проверить**: отображается ли список вопросов (FIFO — первый пришёл, первый обслужен)
- **Проверить**: работает ли пагинация (если вопросов много)

### 4. Ответ на вопрос
- Выбрать вопрос из очереди
- Нажать "Ответить"
- Написать ответ
- **Проверить**: предлагаются ли теги автоматически
- Выбрать теги или добавить новый
- Выбрать "Опубликовать в канал"
- **Проверить**: появляется ли превью поста
- Подтвердить публикацию
- **Проверить**:
  - Пост появился в канале с правильным номером (#N)
  - Пользователь получил уведомление со ссылкой
  - Вопрос исчез из очереди

### 5. Личный ответ
- Ответить на вопрос и выбрать "Ответить лично"
- **Проверить**: пользователь получил ответ в личку
- **Проверить**: вопрос не публикуется в канале

### 6. Отклонение вопроса
- Выбрать вопрос и нажать "Отклонить"
- **Проверить**: вопрос удаляется из очереди

---

## На что обратить внимание

### Поиск
- Синонимы должны работать: "намаз" = "салят" = "молитва"
- Поиск должен находить релевантные ответы даже при неточном запросе
- Порог релевантности: 0.65 (слишком низкие совпадения не показываются)

### Нумерация постов
- Номера постов (#1, #2, #3...) должны быть последовательными
- Номер не должен повторяться

### Теги
- Должны корректно отображаться как хештеги в посте (#намаз, #закят)
- Авто-предложение тегов должно быть релевантным вопросу

### Форматирование постов в канале
- Вопрос выделен
- Ответ читаемый
- Есть дата и номер поста
- Хештеги в конце

### Уведомления
- Пользователь получает уведомление когда его вопрос отвечен
- В уведомлении есть ссылка на пост (если опубликован в канале)

---

## Команды сервера (для отладки)

```bash
# Подключение к серверу
ssh root@150.241.230.19

# Статус бота
systemctl status abu_turab

# Логи в реальном времени
journalctl -u abu_turab -f

# Последние 100 строк логов
journalctl -u abu_turab -n 100 --no-pager

# Перезапуск бота
systemctl restart abu_turab

# Остановка бота
systemctl stop abu_turab

# Запуск бота
systemctl start abu_turab
```

---

## Типичные проблемы

| Проблема | Решение |
|----------|---------|
| Бот не отвечает | Проверить `systemctl status abu_turab` |
| Поиск не находит ответы | Проверить наличие индексов в `/opt/abu_turab/data/` |
| Ошибка при публикации | Проверить права бота в канале (должен быть админом) |
| Нет доступа к админке | Проверить ADMIN_IDS в `.env` |
